// Generated by CoffeeScript 1.6.3
(function() {
  var Schema, TestModel, TestSchema, mocha, mongoose, should, transable;

  require('mocha');

  should = require('chai').should();

  mocha = require("mocha");

  should = require("should");

  transable = require("../mongoose-trashable");

  mongoose = require("mongoose");

  Schema = mongoose.Schema;

  mongoose.connect("mongodb://localhost/test-mongoose-trashable");

  mongoose.connection.on("error", function(err) {
    console.error("MongoDB error: " + err.message);
    return console.log("Make sure MongoDB is up and running on " + database + ".");
  });

  TestSchema = new Schema({});

  TestSchema.plugin(transable);

  TestModel = mongoose.model("Test", TestSchema);

  after(function(done) {
    mongoose.connection.db.dropDatabase();
    return done();
  });

  describe("mongoose-trashable", function() {
    it("trash / untrash methods", function(done) {
      var timestamp;
      timestamp = Date.now();
      new TestModel().trash(function(err, doc) {
        if (err) {
          done(err);
        }
        doc.trashed_at.should.be.within(timestamp, Date.now());
        console.log("[mongoose-trashable_test] doc.trashed_at:" + doc.trashed_at);
        doc.untrash(function(err, doc) {
          should.not.exist(doc.trashed_at);
          doc.untrash(function(err, doc) {
            should.not.exist(doc.trashed_at);
            done();
          });
        });
      });
    });
  });

}).call(this);
